<div id="{$id}" class="row">
    <form action="{$action}" method="{$method|default='POST'}"
        enctype="multipart/form-data"
        class="{$class} {$attr|raw}" onsubmit="return formSubmit();">

        {volist name="rows" id="row"}
        {if condition="$row instanceof tpext\builder\common\Tab"}
        <div class="col-md-12">
            {:$row->render()}
        </div>
        {elseif condition="$row instanceof tpext\builder\form\step"}
        <div class="col-md-12">
            {:$row->render()}
        </div>
        {else/}
        <div class="form-group col-md-{$row->getColSize()} {$row->getClass()} {$row->getErrorClass()}"{$row->getAttr()|raw}>
            {:$row->render()}
        </div>
        {/if}
        {/volist}
    </form>

    <script>
        var ajax = {$ajax};
        var search = '{$search}';
        var lastsearch = '';
    
        function formSubmit()
        {
            if(ajax)
            {
                lightyear.loading('show');
    
                var data = $('#{$id} form').serialize();
               
                $.ajax({
                    url: '{$action}' || location.href,
                    data: data,
                    type: 'POST',
                    dataType: 'html',
                    success: function (data) {
                        setTimeout(function(){
                            lightyear.loading('hide');
                        },500);
                        if(/^\{.+\}$/.test(data))
                        {
                            if (data.status || data.code) {
                                lightyear.notify('操作成功！', 'success');
                            } else {
                                lightyear.notify(data.msg || data.message || '操作失败', 'warning');
                            }
                        }
                        else
                        {
                            $('#' + search).replaceWith(data);
                        }
                    },
                    error: function () {
                        lightyear.loading('hide');
                        lightyear.notify('网络错误', 'danger');
                    }
                });
    
                return false;
            }
    
            return true;
        }
    
    </script>
</div>
